---
layout: "post"
title: "Includes & Layouts: Making My Site a Bit More Automated"
date: 2025-02-28
images: "/assets/images/2025-02-28-includes-layouts"
audio: "/assets/audio"
---

In [_2024:
Year in Review_]({{ site.baseurl }}{% link _posts/2025-01-31-year-in-review.md %})
I mentioned wanting to write better posts and that I would be looking at analytics.
The day after I published,
I figured out how to track web traffic with [Google Analytics](https://developers.google.com/analytics).
I'd like to share the path I took as it taught me more about how my site works under the hood,
as well as give insight to my motivations.

# Web traffic
Google Analytics collects data on sites via a [Google tag](https://support.google.com/tagmanager/answer/11994839?hl=en#:~:text=The%20Google%20tag%20lets%20you,4%2C%20and%20Campaign%20Manager%20360.).
I won't get into the details of how this happens,
but to gain some insight into my site I had to do one of the following:
- Install with a website builder or CMS
- Install manually

I don't use a website builder (e.g., Wix, WordPress), so I opted for the manual processâ€”how bad could it be?

Here are the instructions:
> Below is the Google tag for this account.
> Copy and paste it in the code of every page of your website, immediately after the `<head>` element.
> Don't add more than one Google tag to each page.
> 
> ```html
> <!-- Google tag (gtag.js) -->
> <script async src="..."></script>
> <script>
>     ...some JavaScript code...
> </script>
> ```

Two things stood out to me:
1. Copy and paste it in the code of _**<u>every page of your website</u>**_
2. immediately _**<u>after the <code><head></code> element</u>**_

The first I can doâ€”I already copy/paste a [giscuss](https://giscus.app/) `<script>` element to the bottom of all of my posts
so visitors can comment and react.
> [!NOTE]
> 
> I'd rather find some automated way.
> I often forget to add the comment section when I publish and have to add it after the fact.
> It's quite repetitive and I should probably automate that too.

The second is a bit harder.
Most of my posts are written in [Markdown](https://en.wikipedia.org/wiki/Markdown),
so they don't exactly have a visible `<head>` element.
Now if I go to my actual site and inspect any of the pages, I can see ğŸ‘€ that there is such an element.

<center>
    <figure>
        <img src="{{ page.images | relative_url }}/head-element.png">
        <figcaption>There it is!</figcaption>
    </figure>
</center>

But how do I add this Google tag immediately after it?

# Down the Jekyll rabbit hole
I may have mentioned it in a previous post, but my site is generated by [Jekyll](https://jekyllrb.com/).
From the [Jekyll GitHub repo](https://github.com/jekyll/jekyll):
> Jekyll is a simple, blog-aware, static site generator perfect for personal, project, or organization sites.
> Think of it like a file-based CMS, without all the complexity.
> Jekyll takes your content, renders Markdown and Liquid templates,
> and spits out a complete, static website ready to be served by Apache, Nginx or another web server.
> Jekyll is the engine behind [GitHub Pages](https://pages.github.com/),
> which you can use to host sites right from your GitHub repositories.

Hold on; what was that?
> ... renders Markdown and Liquid **<u>templates</u>** ...

Templates!

My first (actually the first five...) result after googling "jekyll template"
was the [Jekyll Themes](https://jekyllrb.com/docs/themes/) page.
Under the section
[Understanding gem-based themes](https://jekyllrb.com/docs/themes/#understanding-gem-based-themes)
I read a word that sounded very familiar: "Minima"

That's the [theme
my blog uses](https://github.com/it176131/it176131.github.io/blob/b3f56f489390a3da791fb70c3d1bb71d008501d9/_config.yml#L19)!

According to the _Themes_ docs:
> With gem-based themes,
> some of the siteâ€™s directories
> (such as the `assets`, `_data`, `_layouts`, `_includes`, and `_sass` directories) are stored in the themeâ€™s gem,
> hidden from your immediate view.

Okay, good to know.
That would explain
why I don't see any of the directories in my repo except [`assets/`](https://github.com/it176131/it176131.github.io/tree/b3f56f489390a3da791fb70c3d1bb71d008501d9/assets).

Reading on:
> #### [Overriding theme defaults](https://jekyllrb.com/docs/themes/#overriding-theme-defaults)
> 
> Jekyll themes set default data, layouts, includes, and stylesheets.
> However, you can override any of the theme defaults with your own site content.

Interesting!

> For example, if your selected theme has a `page` layout,
> you can override the themeâ€™s layout by creating your own `page` layout in the `_layouts` directory
> (that is, `_layouts/page.html`).

Ah!
âœ¨**_<u>HTML</u>_**âœ¨!
Cue the angelic choir.
<audio controls>
    <source src="{{ page.audio }}/Angelic-choir-ahh.mp3" type="audio/mpeg">
    Your browser does not support the audio element.
</audio>

Now all I have to do is find my local `_layouts/page.html` file.
I wonder how... oh right.
It's in the _Themes_ docs:
> 1. Run `bundle info --path` followed by the name of the themeâ€™s gem,
> e.g., `bundle info --path minima` for Jekyllâ€™s default theme.

So I run it.
```shell
$ bundle info --path minima
```

And of course I get an error:
```text
Could not locate Gemfile or .bundle/ directory
```

ğŸ˜‘

A few searches and Stack Overflow posts later, I ran the following:
```shell
$ bundle init
```

This added a `Gemfile` to my repo directory.
I guess the previous command should work now?
```shell
$ bundle info --path minima
```

Eh!
No.
Now I get the error:
```text
Could not find gem 'minima'.
```

New error equals... progress? ğŸ¤·

More searching yielded a new command (and a prayer ğŸ™):
```shell
$ bundle install
```

Another (!) new file was added to my directory, `Gemfile.lock`, and the following message was written:
```text
The Gemfile specifies no dependencies
Bundle complete! 0 Gemfile dependencies, 1 gem now installed.
Use `bundle info [gemname]` to see where a bundle gem is installed.
```

Okay, the command _has_ to work nowâ€”the output just told me to use it!
```shell
$ bundle info --path minima
```

```text
Could not find gem 'minima'.
```

Grrrr... ğŸ˜ 

More searching.

At the top of the Jekyll home page I find the following command:
```shell
$ gem install bundler jekyll
```

I say "what the heck" and run it.
Out comes some new text:
```text
A new release of Ruby Gems is available: 3.4.10 -> 3.6.3!
Run `gem update --system 3.6.3` to update your installation.
```

Okay... why is this starting to feel like a wild goose chase?
I run the command anyway, followed by `bundle update minima`.
I figure a new command might give a new error.

But of course I was wrong ğŸ˜‚ğŸ˜­:
```text
Could not find the gem 'minima'.
```

Back to Google.

I discover that I need to add `gem "minima"` to my `Gemfile`.
I open it up and sure enough there's a commented out line that says `# gem "rails"`.
I drop the new line right under it and rerun the previous command.
```text
Bundle complete!
```

It worked!
I run `bundle info --path minima` and out pops the following (less some redactions ğŸ˜‰):
```text
~/Ruby32-x64/lib/ruby/gems/3.2.0/gems/minima-2.5.2
```

Hallelujah!
<audio controls>
    <source src="{{ page.audio }}/Hallelujah-sound-effect.mp3" type="audio/mpeg">
    Your browser does not support the audio element.
</audio>
I found the door to the HTML files.

# A custom `<head>`
Immediately inside the `minima-2.5.2/` directory I find the following:
```text
ğŸ“‚ ~/Ruby32-x64/lib/ruby/gems/3.2.0/gems/minima-2.5.2
â”œâ”€â”€ ğŸ“„ LICENSE.txt
â”œâ”€â”€ ğŸ“„ README.txt
â”œâ”€â”€ ğŸ“‚ _includes
â”œâ”€â”€ ğŸ“‚ _layouts
â”œâ”€â”€ ğŸ“‚ _sass
â””â”€â”€ ğŸ“‚ assets
```

`_layouts/` sounds like a good place to start (considering the docs said that's where `_layouts/page.html` is).
```text
ğŸ“‚ ~/Ruby32-x64/lib/ruby/gems/3.2.0/gems/minima-2.5.2
â”œâ”€â”€ ğŸ“„ LICENSE.txt
â”œâ”€â”€ ğŸ“„ README.txt
â”œâ”€â”€ ğŸ“‚ _includes
â”œâ”€â”€ ğŸ“‚ _layouts
â”‚   â”œâ”€â”€ <> default.html
â”‚   â”œâ”€â”€ <> home.html
â”‚   â”œâ”€â”€ <> page.html
â”‚   â””â”€â”€ <> post.html
â”œâ”€â”€ ğŸ“‚ _sass
â””â”€â”€ ğŸ“‚ assets
```

Thinking back to all the blog posts I've written (including this one),
I've always set my [front matter](https://jekyllrb.com/docs/front-matter/) `layout` to `"post"`.
And now there's a file in the `_layouts/` directory called `"post.html"`.
Could this be the template for all of my posts?
ğŸ¤”

Here are the contents of `"post.html"`:
{% raw %}
```html
---
layout: default
---
<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">{{ page.title | escape }}</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="{{ page.date | date_to_xmlschema }}" itemprop="datePublished">
        {%- assign date_format = site.minima.date_format | default: "%b %-d, %Y" -%}
        {{ page.date | date: date_format }}
      </time>
      {%- if page.author -%}
        â€¢ <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">{{ page.author }}</span></span>
      {%- endif -%}</p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    {{ content }}
  </div>

  {%- if site.disqus.shortname -%}
    {%- include disqus_comments.html -%}
  {%- endif -%}

  <a class="u-url" href="{{ page.url | relative_url }}" hidden></a>
</article>

```
{% endraw %}

And here's a snippet of my very first blog post's HTML rendering (via the inspector):
<center>
    <img src="{{ page.images | relative_url }}/post-html-snippet.png">
</center>

Looking only at the HTML elements, I think it's fair to say "yes," this is the template.

With a quick glance I can see that there isn't a `<head>` element,
but there is front matter with the `layout` set to `default`.
Over to the `_layouts/default.html` I go.

{% raw %}
```html
<!DOCTYPE html>
<html lang="{{ page.lang | default: site.lang | default: "en" }}">

  {%- include head.html -%}

  <body>

    {%- include header.html -%}

    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        {{ content }}
      </div>
    </main>

    {%- include footer.html -%}

  </body>

</html>

```
{% endraw %}

No front matter here,
but there is an [`include` tag](https://jekyllrb.com/docs/includes/) that specifically references "head.html".
On to the `_includes/` directory.
```text
ğŸ“‚ ~/Ruby32-x64/lib/ruby/gems/3.2.0/gems/minima-2.5.2
â”œâ”€â”€ ğŸ“„ LICENSE.txt
â”œâ”€â”€ ğŸ“„ README.txt
â”œâ”€â”€ ğŸ“‚ _includes
â”‚   â”œâ”€â”€ <> disqus_comments.html
â”‚   â”œâ”€â”€ <> footer.html
â”‚   â”œâ”€â”€ <> google-analytics.html
â”‚   â”œâ”€â”€ <> head.html
â”‚   â”œâ”€â”€ <> header.html
â”‚   â”œâ”€â”€ <> icon-github.html
â”‚   â”œâ”€â”€ ğŸ–¼ï¸ icon-github.svg
â”‚   â”œâ”€â”€ <> icon-twitter.html
â”‚   â”œâ”€â”€ ğŸ–¼ï¸ icon-twitter.svg
â”‚   â””â”€â”€ <> social.html
â”œâ”€â”€ ğŸ“‚ _layouts
â”‚   â”œâ”€â”€ <> default.html
â”‚   â”œâ”€â”€ <> home.html
â”‚   â”œâ”€â”€ <> page.html
â”‚   â””â”€â”€ <> post.html
â”œâ”€â”€ ğŸ“‚ _sass
â””â”€â”€ ğŸ“‚ assets
```

Sure enough, there's a `_includes/head.html` file.
{% raw %}
```html
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  {%- seo -%}
  <link rel="stylesheet" href="{{ "/assets/main.css" | relative_url }}">
  {%- feed_meta -%}
  {%- if jekyll.environment == 'production' and site.google_analytics -%}
    {%- include google-analytics.html -%}
  {%- endif -%}
</head>

```
{% endraw %}

And there resides the elusive `<head>` element.

According to the Jekyll docs,
all I have to do to customize this is copy this file to my repo's directory and then have my way with it.
And that's what I did.
```shell
# From my repo's directory...
$ cp ~/Ruby32-x64/lib/ruby/gems/3.2.0/gems/minima-2.5.2/_includes/head.html ./_includes/head.html
```

To make things easier on myself (and practice using an `include` tag),
I created an additional file in my new `_includes/` directoryâ€”`_includes/analytics.html`â€”to hold my Google tag.
```text
ğŸ“‚ it176131.github.io
â””â”€â”€ ğŸ“‚ _includes
    â”œâ”€â”€ <> analytics.html
    â””â”€â”€ <> head.html
```

I then "included" the Google tag in `_includes/head.html` immediately after the `<head>` element
(just like the Google Analytics instructions said to):
{% raw %}
```html
<head>
  {% include analytics.html %}  <!-- RIGHT HERE!!! -->
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  {%- seo -%}
  <link rel="stylesheet" href="{{ "/assets/main.css" | relative_url }}">
  {%- feed_meta -%}
  {%- if jekyll.environment == 'production' and site.google_analytics -%}
    {%- include google-analytics.html -%}
  {%- endif -%}
</head>

```
{% endraw %}

To check if the tag was present on not just my blog posts but my main page as well,
I spun up a local server and inspected the HTML:
<center>
    <img src="{{ page.images | relative_url }}/gtag.png">
</center>

No errors!
I must be getting the hang of this.
ğŸ˜

[//]: # (With some digging I discovered the `_includes/` and `_layouts/` directories.)
[//]: # (The `_layouts/` directory houses the "templates" used by Jekyll to convert my pages to HTML.)
[//]: # (The `_includes/` directory holds snippets of HTML that don't do anything by themselves,)
[//]: # (but can augment the HTML in a layout template if "included.")

This is where [front matter](https://jekyllrb.com/docs/front-matter/) at the top of each post started to make sense.
On any given post on my blog you'll find a section at the top called _front matter_.
Its job is to tell Jekyll _how to format this Markdown when converting to HTML_.
> [!NOTE]
> 
> Verify this!!

It's represented as a block of yaml-like text enclosed by three dashes on top and bottom.
For example:
```yaml
---
front matter goes here!
---
```

All of my posts have the following front matter keys at a minimum:
- `layout`
- `title`
- `date`

> [!NOTE]
> 
> add Jekyll(?) definitions for each!

I've (almost) always set the layout to "post"
because that's what the [GitHub Pages tutorial](https://github.com/skills/github-pages)
(course?) said to do.
I think the only time I didn't was for my [rÃ©sumÃ©](https://raw.githubusercontent.com/it176131/it176131.github.io/refs/heads/main/resume.md) when I set the layout to "page".

After finding a file called _post.html_ in the `_layouts/` directory
and seeing a very similar HTML structure to my already-published posts,
I gathered that this was the template Jekyll was using to format my posts
(or at least any page that the layout set to "post" in the front matter).

> [!NOTE]
> 
> I'll want to show the contents of _post.html_ at some point.
> I'd probably also want
> to compare it with my [_Hello World_]({{ site.baseurl }}{% link _posts/2023-12-04-hello-world.md %})
> post (as HTML) so I can draw parallels.

The _page.html_ has references to files in the `_includes/` directory with includes tags.
This would be how I could automatically add the Google Analytics `<script>` element to every page on my site.
But of course, to include it on every page meant using the top-most HTML file rather than the _post.html_ because...
> [!NOTE]
> 
> I don't like how this is written/how it sounds.

After creating an `analytics.html` file in my own repo's `_includes/` directory,
I referenced it in my `_includes/head.html` file.
With a quick refresh of my local Jekyll server and an inspection of a couple of my site's pages,
I could see the Google Analytics `<script>`.
It had worked!

I pushed all of my changes to GitHub and merged with my main branch.
After deployment I checked my live-site and again saw the script.
I felt like I had unlocked a level in my understanding of Jekyll, GitHub Pages, and HTML.

I completed all of this on February 1, 2025â€”the day after I published [_2024:
Year in Review_]({{ site.baseurl }}{% link _posts/2025-01-31-year-in-review.md %}).
For the last couple of weeks I've been looking at my site's web traffic.
It's been enjoyable to see.
I don't have a lot of visitors; maybe one or two a day with most of them going to my more recent posts.
But it feels good to be seen.

In January 2024, when my site was a few posts old, I added the ability to comment and react to my posts via [giscuss](https://giscus.app/).
After adding Google Analytics to my `_includes/` and letting Jekyll handle the automation,
I figured it was hightime to do the same with my comments.

Yes,
I've literally been copy/pasting an HTML script to the bottom of every post
since I published [_Comments_]({{ site.baseurl }}{% link _posts/2024-01-10-comments.md %}).
It's been tedious, and I've accidentally published multiple times without the script,
having to go back and add it after the fact.
It's not that I didn't want to automate it
â€”I considered writing a pre-commit hook to check for itâ€”I just didn't know how.

Until now.
> [!NOTE]
> 
> Walk through adding the giscuss `<script>` to `_includes/` and referencing it in `_layouts/post.html`.

Much better.
After testing that I wouldn't lose my existing comments and reactions,
I removed the old `<script>` elements from the bottoms of my existing posts.
Now I can write and publish without having to worry that readers won't be able to leave feedback.

Last year, when I first added the ability to comment, my goal was to get feedback on my posts.
To have conversations with my readers.

After sharing my posts on LinkedIn to spread the word that I have a blog, a weird even occurred:
readers started reacting and writing comments on my LinkedIn post rather than my actual blog posts.

It's kind of funny.
I got through an effort to allow interaction on my site and it turns out all I had to do was share on LinkedIn.
I can think of reasons why this happened:
- readers don't have GitHub accounts so can't comment directly
- the path of least resistance to interact is on LinkedIn where the post was discovered
- etc.

Whatever it is, I welcome it.

I write the posts and share them in an effort to educate, learn, and converse.
It shouldn't matter how my students, teachers, readers,
friends choose to interact as long as I can provide a way to do so.
Comment on LinkedIn.
React on my site.
Whatever you do and where you do it, I see and read them all.
And I appreciate it ğŸ¤—.